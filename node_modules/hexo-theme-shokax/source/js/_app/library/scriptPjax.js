"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pjaxScript = exports.getScript = exports.cloudflareInit = void 0;
function cloudflareInit() {
    let inCloudFlare = true;
    window.addEventListener('DOMContentLoaded', function () {
        inCloudFlare = false;
    });
    if (document.readyState === 'loading') {
        window.addEventListener('load', function () {
            if (inCloudFlare) {
                window.dispatchEvent(new Event('DOMContentLoaded'));
                console.log('%c ☁️cloudflare patch ' + '%c running(rocket & minify)', 'color: white; background: #ff8c00; padding: 5px 3px;', 'padding: 4px;border:1px solid #ff8c00');
            }
        });
    }
}
exports.cloudflareInit = cloudflareInit;
const getScript = (url, callback, condition) => {
    if (condition) {
        callback();
    }
    else {
        let script = document.createElement('script');
        script.onload = function (_, isAbort) {
            if (isAbort || !script.readyState) {
                console.log('abort!');
                script.onload = null;
                script = undefined;
                if (!isAbort && callback)
                    setTimeout(callback, 0);
            }
        };
        script.src = url;
        document.head.appendChild(script);
    }
};
exports.getScript = getScript;
const pjaxScript = (element) => {
    const { text, parentNode, id, className, type, src, dataset } = element;
    const code = text || element.textContent || element.innerHTML || '';
    parentNode.removeChild(element);
    const script = document.createElement('script');
    if (id) {
        script.id = id;
    }
    if (className) {
        script.className = className;
    }
    if (type) {
        script.type = type;
    }
    if (src) {
        script.src = src;
        script.async = false;
    }
    if (dataset.pjax !== undefined) {
        script.dataset.pjax = '';
    }
    if (code !== '') {
        script.appendChild(document.createTextNode(code));
    }
    parentNode.appendChild(script);
};
exports.pjaxScript = pjaxScript;
