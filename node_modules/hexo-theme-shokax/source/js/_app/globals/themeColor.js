"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.themeColorListener = exports.changeMetaTheme = exports.autoDarkmode = exports.changeTheme = void 0;
const storage_1 = require("../library/storage");
const dom_1 = require("../library/dom");
const globalVars_1 = require("./globalVars");
const changeTheme = (type) => {
    const btn = (0, dom_1.$dom)('.theme .ic');
    if (type === 'dark') {
        globalVars_1.HTML.attr('data-theme', type);
        btn.removeClass('i-sun');
        btn.addClass('i-moon');
    }
    else {
        globalVars_1.HTML.attr('data-theme', null);
        btn.removeClass('i-moon');
        btn.addClass('i-sun');
    }
};
exports.changeTheme = changeTheme;
const autoDarkmode = () => {
    if (CONFIG.auto_dark.enable) {
        if (new Date().getHours() >= CONFIG.auto_dark.start || new Date().getHours() <= CONFIG.auto_dark.end) {
            (0, exports.changeTheme)('dark');
        }
        else {
            (0, exports.changeTheme)();
        }
    }
};
exports.autoDarkmode = autoDarkmode;
const changeMetaTheme = (color) => {
    if (globalVars_1.HTML.attr('data-theme') === 'dark') {
        color = '#222';
    }
    (0, dom_1.$dom)('meta[name="theme-color"]').attr('content', color);
};
exports.changeMetaTheme = changeMetaTheme;
const themeColorListener = () => {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (mediaQueryList) => {
        if (mediaQueryList.matches) {
            (0, exports.changeTheme)('dark');
        }
        else {
            (0, exports.changeTheme)();
        }
    });
    const t = storage_1.$storage.get('theme');
    if (t) {
        (0, exports.changeTheme)(t);
    }
    else {
        if (CONFIG.darkmode) {
            (0, exports.changeTheme)('dark');
        }
    }
};
exports.themeColorListener = themeColorListener;
